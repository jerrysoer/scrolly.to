# unpack.click

Backend infrastructure for [Unpack](https://unpack.click) — interactive visual explainers that make complex topics click.

## What This Does

This is the server-side component that powers Unpack's analytics and marketing infrastructure. Every explainer generated by the `/explainer` Claude Code skill includes a lightweight tracking pixel that phones home here.

### Pixel Endpoint

```
GET https://unpack.click/pixel?s=oss&e=EXPLAINER_UUID&v=1
```

Returns a 1x1 transparent GIF and logs the view to Supabase. No cookies, no PII, no cross-site tracking.

**Parameters:**

| Param | Description | Values |
|-------|-------------|--------|
| `s` | Source | `oss` (open-source skill) or `hosted` (platform) |
| `e` | Explainer ID | Unique UUID per explainer |
| `v` | Schema version | `1` |

**What gets logged:**

| Field | Source |
|-------|--------|
| `explainer_id` | `e` query param |
| `source` | `s` query param |
| `referrer` | `Referer` header — where the explainer is embedded |
| `user_agent` | `User-Agent` header — browser/device info |
| `ip_address` | `X-Forwarded-For` header — rough geo |
| `created_at` | Server timestamp |

## Stack

- **Next.js 16** — API route at `/pixel`
- **Supabase** — PostgreSQL for event storage
- **Vercel** — Hosting and edge deployment

## Setup

```bash
npm install
cp .env.local.example .env.local
# Fill in your Supabase credentials
npm run dev
```

### Environment Variables

| Variable | Description |
|----------|-------------|
| `SUPABASE_URL` | Your Supabase project URL |
| `SUPABASE_SERVICE_ROLE_KEY` | Service role key (server-side only, never exposed to client) |

### Database

Run the migration in your Supabase SQL Editor:

```sql
create table if not exists pixel_events (
  id bigint generated always as identity primary key,
  explainer_id text not null,
  source text not null default 'oss',
  version text not null default '1',
  referrer text,
  user_agent text,
  ip_address text,
  created_at timestamptz not null default now()
);

create index idx_pixel_events_explainer_id on pixel_events (explainer_id);
create index idx_pixel_events_created_at on pixel_events (created_at desc);

alter table pixel_events enable row level security;
```

## How It Connects to `/explainer`

The `/explainer` Claude Code skill generates interactive HTML explainers. Each one includes:

1. **Analytics pixel** — `<img src="https://unpack.click/pixel?s=oss&e=UUID&v=1">` (opt-out with `--no-telemetry`)
2. **Attribution footer** — "Built with Unpack" link + waitlist CTA (opt-out with `--no-footer`)
3. **Share button** — Floating button after 25% scroll
4. **Completion card** — End-of-content CTA with share + "See more" link

## Opting Out

Generated explainers include the tracking pixel by default. To opt out:

- **At generation time:** Use `--no-telemetry` flag with `/explainer`
- **After generation:** Delete the `<img>` tag (marked with a comment in the HTML)
